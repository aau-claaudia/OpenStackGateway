//[OpenStackGateway](../../../index.md)/[dk.aau.claaudia.openstackgateway.services](../index.md)/[OpenStackService](index.md)

# OpenStackService

[jvm]\
@Service

class [OpenStackService](index.md)(config: [OpenStackProperties](../../dk.aau.claaudia.openstackgateway.config/-open-stack-properties/index.md), provider: [ProviderProperties](../../dk.aau.claaudia.openstackgateway.config/-provider-properties/index.md), messages: [Messages](../../dk.aau.claaudia.openstackgateway.config/-messages/index.md), templateService: [TemplateService](../-template-service/index.md), uCloudClient: UCloudClient)

## Constructors

| | |
|---|---|
| [OpenStackService](-open-stack-service.md) | [jvm]<br>constructor(config: [OpenStackProperties](../../dk.aau.claaudia.openstackgateway.config/-open-stack-properties/index.md), provider: [ProviderProperties](../../dk.aau.claaudia.openstackgateway.config/-provider-properties/index.md), messages: [Messages](../../dk.aau.claaudia.openstackgateway.config/-messages/index.md), templateService: [TemplateService](../-template-service/index.md), uCloudClient: UCloudClient) |

## Types

| Name | Summary |
|---|---|
| [Companion](-companion/index.md) | [jvm]<br>object [Companion](-companion/index.md) |

## Functions

| Name | Summary |
|---|---|
| [asyncChargeDeleteJob](async-charge-delete-job.md) | [jvm]<br>fun [asyncChargeDeleteJob](async-charge-delete-job.md)(job: Job)<br>Charge a job before deleting it. FIXME Maybe add logic to disallow deletion if charging is unsuccessful. |
| [asyncChargeJob](async-charge-job.md) | [jvm]<br>fun [asyncChargeJob](async-charge-job.md)(stack: Stack)<br>Charge a stack asynchronous to avoid exceptions stopping other stacks from being charged |
| [asyncMonitorCreations](async-monitor-creations.md) | [jvm]<br>fun [asyncMonitorCreations](async-monitor-creations.md)(jobs: [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Job&gt;)<br>Start creation monitor function for each job in a list of jobs |
| [asyncMonitorDeletions](async-monitor-deletions.md) | [jvm]<br>fun [asyncMonitorDeletions](async-monitor-deletions.md)(jobs: [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Job&gt;)<br>Start deletion monitor function for each job in a list of jobs |
| [asyncMonitorShutdownInstanceSendUpdate](async-monitor-shutdown-instance-send-update.md) | [jvm]<br>fun [asyncMonitorShutdownInstanceSendUpdate](async-monitor-shutdown-instance-send-update.md)(server: Server, job: Job, period: [Long](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html)) |
| [asyncMonitorStackResumes](async-monitor-stack-resumes.md) | [jvm]<br>fun [asyncMonitorStackResumes](async-monitor-stack-resumes.md)(jobs: [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Job&gt;) |
| [asyncMonitorStackSuspensions](async-monitor-stack-suspensions.md) | [jvm]<br>fun [asyncMonitorStackSuspensions](async-monitor-stack-suspensions.md)(jobs: [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Job&gt;) |
| [asyncMonitorStartInstanceSendUpdate](async-monitor-start-instance-send-update.md) | [jvm]<br>fun [asyncMonitorStartInstanceSendUpdate](async-monitor-start-instance-send-update.md)(server: Server, job: Job) |
| [asyncStackCreation](async-stack-creation.md) | [jvm]<br>fun [asyncStackCreation](async-stack-creation.md)(job: Job, template: Template)<br>Parse parameters from the ucloud job, send parameters and template to openstack in a createStack request |
| [attackVolumeToInstance](attack-volume-to-instance.md) | [jvm]<br>fun [attackVolumeToInstance](attack-volume-to-instance.md)(instance: Server, volume: Volume) |
| [calculatePeriodAndNewChargeTimeForProduct](calculate-period-and-new-charge-time-for-product.md) | [jvm]<br>fun [calculatePeriodAndNewChargeTimeForProduct](calculate-period-and-new-charge-time-for-product.md)(product: Product, stack: Stack): [Pair](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-pair/index.html)&lt;[Long](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html), [Instant](https://docs.oracle.com/javase/8/docs/api/java/time/Instant.html)&gt; |
| [chargeAllStacks](charge-all-stacks.md) | [jvm]<br>fun [chargeAllStacks](charge-all-stacks.md)()<br>For each stack in openstack, charge the corresponding job in ucloud. |
| [chargeCreditsJob](charge-credits-job.md) | [jvm]<br>fun [chargeCreditsJob](charge-credits-job.md)(jobId: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), lastChargedTime: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), cpuCores: [Long](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html), period: [Long](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html)): ResourceChargeCreditsResponse |
| [chargeDeleteJobs](charge-delete-jobs.md) | [jvm]<br>fun [chargeDeleteJobs](charge-delete-jobs.md)(jobs: [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Job&gt;) |
| [chargeJob](charge-job.md) | [jvm]<br>fun [chargeJob](charge-job.md)(job: Job, stack: Stack, instance: Server, period: [Long](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html), cpuCores: [Int](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-int/index.html), newChargeTime: [Instant](https://docs.oracle.com/javase/8/docs/api/java/time/Instant.html)) |
| [chargeStack](charge-stack.md) | [jvm]<br>fun [chargeStack](charge-stack.md)(stack: Stack)<br>Charge stack by calling JobControl.chargeCredits |
| [checkCreditsJob](check-credits-job.md) | [jvm]<br>fun [checkCreditsJob](check-credits-job.md)(jobId: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), lastChargedTime: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), cpuCores: [Long](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html), period: [Long](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html)): ResourceChargeCreditsResponse |
| [createStack](create-stack.md) | [jvm]<br>fun [createStack](create-stack.md)(name: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), template: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), parameters: [MutableMap](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-mutable-map/index.html)&lt;[String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)&gt;)<br>Send a stack creation request to openstack. Use the openstack4j builder to create the request and send it to openstack We don't return anything here because, since tasks are started to monitor the creation. |
| [createStacks](create-stacks.md) | [jvm]<br>fun [createStacks](create-stacks.md)(jobs: [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Job&gt;)<br>Start the process of creating stacks from ucloud jobs For now, we use a single template, but this can change in the future. For each job start an asynchronous task |
| [createVolume](create-volume.md) | [jvm]<br>fun [createVolume](create-volume.md)(name: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), description: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), size: [Int](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-int/index.html)) |
| [deattachVolumeToInstance](deattach-volume-to-instance.md) | [jvm]<br>fun [deattachVolumeToInstance](deattach-volume-to-instance.md)(instance: Server, volume: Volume) |
| [deleteJob](delete-job.md) | [jvm]<br>fun [deleteJob](delete-job.md)(job: Job)<br>Takes a job and finds the corresponding stack then sends a stack delete request to openstack. |
| [deleteNotChargedStacks](delete-not-charged-stacks.md) | [jvm]<br>fun [deleteNotChargedStacks](delete-not-charged-stacks.md)() |
| [deleteVolume](delete-volume.md) | [jvm]<br>fun [deleteVolume](delete-volume.md)(id: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)) |
| [estimateProductPriceForPeriod](estimate-product-price-for-period.md) | [jvm]<br>fun [estimateProductPriceForPeriod](estimate-product-price-for-period.md)(job: Job, period: [Long](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html)): [Double](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-double/index.html)? |
| [findStackIncludeDeleted](find-stack-include-deleted.md) | [jvm]<br>fun [findStackIncludeDeleted](find-stack-include-deleted.md)(job: Job): Stack? |
| [getActiveStacks](get-active-stacks.md) | [jvm]<br>fun [getActiveStacks](get-active-stacks.md)(): [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Stack&gt; |
| [getConsole](get-console.md) | [jvm]<br>fun [getConsole](get-console.md)(serverId: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)): VNCConsole? |
| [getFlavorById](get-flavor-by-id.md) | [jvm]<br>fun [getFlavorById](get-flavor-by-id.md)(id: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)?): Flavor? |
| [getFlavorByName](get-flavor-by-name.md) | [jvm]<br>fun [getFlavorByName](get-flavor-by-name.md)(name: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)?): Flavor? |
| [getFlavorExtraSpecs](get-flavor-extra-specs.md) | [jvm]<br>fun [getFlavorExtraSpecs](get-flavor-extra-specs.md)(id: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)?): [MutableMap](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-mutable-map/index.html)&lt;[String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)&gt; |
| [getImage](get-image.md) | [jvm]<br>fun [getImage](get-image.md)(id: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)?): Image? |
| [getInstanceFromId](get-instance-from-id.md) | [jvm]<br>fun [getInstanceFromId](get-instance-from-id.md)(id: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)): Server? |
| [getInstanceFromStack](get-instance-from-stack.md) | [jvm]<br>fun [getInstanceFromStack](get-instance-from-stack.md)(stack: Stack): Server? |
| [getLastChargedFromStack](get-last-charged-from-stack.md) | [jvm]<br>fun [getLastChargedFromStack](get-last-charged-from-stack.md)(stack: Stack): [Instant](https://docs.oracle.com/javase/8/docs/api/java/time/Instant.html)<br>Retrieve lastCharged timestamp from stack in openstack |
| [getSecurityGroup](get-security-group.md) | [jvm]<br>fun [getSecurityGroup](get-security-group.md)(id: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)?): SecurityGroup? |
| [getStackByJob](get-stack-by-job.md) | [jvm]<br>fun [getStackByJob](get-stack-by-job.md)(job: Job, includeDeleted: [Boolean](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-boolean/index.html) = false): Stack?<br>Retrieve corresponding stack in openstack of a UCloud job. |
| [getStackByName](get-stack-by-name.md) | [jvm]<br>fun [getStackByName](get-stack-by-name.md)(stackName: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)): Stack?<br>Wrapper function to make mocking possible in unit testing |
| [getStackEvents](get-stack-events.md) | [jvm]<br>fun [getStackEvents](get-stack-events.md)(stackName: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), stackIdentity: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)): [MutableList](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-mutable-list/index.html)&lt;out Event&gt;? |
| [listFlavors](list-flavors.md) | [jvm]<br>fun [listFlavors](list-flavors.md)(): [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Flavor?&gt; |
| [listImages](list-images.md) | [jvm]<br>fun [listImages](list-images.md)(filterParams: [Map](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-map/index.html)&lt;[String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)&gt;): [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Image?&gt; |
| [listServers](list-servers.md) | [jvm]<br>fun [listServers](list-servers.md)(): [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Server?&gt; |
| [listVolumes](list-volumes.md) | [jvm]<br>fun [listVolumes](list-volumes.md)(): [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Volume&gt; |
| [mapImage](map-image.md) | [jvm]<br>fun [mapImage](map-image.md)(name: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), version: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), toolImage: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)?): [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)<br>Given a ucloud application name and version find the corresponding openstack image Since ucloud uses name and version and not a unique name/id we use this config mapping instead of a strict naming convention of images The config is also used to control which images are available |
| [monitorCreation](monitor-creation.md) | [jvm]<br>fun [monitorCreation](monitor-creation.md)(job: Job)<br>Monitor job and send status to ucloud when jobs are running or failed Polls openstack continually for the corresponding stack Based on the config, have a delay between each poll and a timeout to stop polling. When the job is found in a create complete state, send the output IP to ucloud in a job running update If this IP is not found or the stack isnt created within the timeout, send a job failed update |
| [monitorDeletion](monitor-deletion.md) | [jvm]<br>fun [monitorDeletion](monitor-deletion.md)(job: Job)<br>Monitor job and send status to ucloud when jobs are found in deleted state Polls openstack continually for the corresponding stack Based on the config, have a delay between each poll and a timeout to stop polling. When the job is found in a delete complete state, send the output IP to ucloud in a job success update If this IP is not found or the stack isn't created within the timeout, don't send status |
| [monitorInstance](monitor-instance.md) | [jvm]<br>fun [monitorInstance](monitor-instance.md)(job: Job, expectedStatus: [InstanceStatus](../../dk.aau.claaudia.openstackgateway.models/-instance-status/index.md)) |
| [monitorShutdownInstanceSendUpdate](monitor-shutdown-instance-send-update.md) | [jvm]<br>fun [monitorShutdownInstanceSendUpdate](monitor-shutdown-instance-send-update.md)(server: Server, job: Job, period: [Long](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html)) |
| [monitorStartInstanceSendUpdate](monitor-start-instance-send-update.md) | [jvm]<br>fun [monitorStartInstanceSendUpdate](monitor-start-instance-send-update.md)(server: Server, job: Job) |
| [monitorThreads](monitor-threads.md) | [jvm]<br>fun [monitorThreads](monitor-threads.md)() |
| [prepareParameters](prepare-parameters.md) | [jvm]<br>fun [prepareParameters](prepare-parameters.md)(job: Job): [MutableMap](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-mutable-map/index.html)&lt;[String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)&gt;<br>Prepare parameters for the stack template This parses ucloud application properties to a map that matches parameters in the stack template For now, there are some hardcoded parameters since we only use a single template |
| [removeFailedJobs](remove-failed-jobs.md) | [jvm]<br>fun [removeFailedJobs](remove-failed-jobs.md)() |
| [resumeJobs](resume-jobs.md) | [jvm]<br>fun [resumeJobs](resume-jobs.md)(jobs: [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Job&gt;) |
| [resumeStack](resume-stack.md) | [jvm]<br>fun [resumeStack](resume-stack.md)(stack: Stack) |
| [retrieveProducts](retrieve-products.md) | [jvm]<br>@Cacheable(value = [&quot;products&quot;])<br>fun [retrieveProducts](retrieve-products.md)(): [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;ComputeSupport&gt; |
| [retrieveUcloudJob](retrieve-ucloud-job.md) | [jvm]<br>fun [retrieveUcloudJob](retrieve-ucloud-job.md)(ucloudId: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html)): Job? |
| [sendCreditDeficitUpdates](send-credit-deficit-updates.md) | [jvm]<br>fun [sendCreditDeficitUpdates](send-credit-deficit-updates.md)() |
| [sendInstanceRestartedMessage](send-instance-restarted-message.md) | [jvm]<br>fun [sendInstanceRestartedMessage](send-instance-restarted-message.md)(jobId: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html))<br>A shortcut function for sending job instance restart message |
| [sendInstanceShutdownAction](send-instance-shutdown-action.md) | [jvm]<br>fun [sendInstanceShutdownAction](send-instance-shutdown-action.md)(server: Server) |
| [sendInstanceShutdownMessage](send-instance-shutdown-message.md) | [jvm]<br>fun [sendInstanceShutdownMessage](send-instance-shutdown-message.md)(jobId: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), deficit: [Double](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-double/index.html)?)<br>A shortcut function for sending job instance shutdown message |
| [sendInstanceStartAction](send-instance-start-action.md) | [jvm]<br>fun [sendInstanceStartAction](send-instance-start-action.md)(server: Server) |
| [sendJobFailedMessage](send-job-failed-message.md) | [jvm]<br>fun [sendJobFailedMessage](send-job-failed-message.md)(jobId: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), message: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html))<br>A shortcut function for sending job failed update message |
| [sendJobRunningMessage](send-job-running-message.md) | [jvm]<br>fun [sendJobRunningMessage](send-job-running-message.md)(jobId: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), message: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html))<br>A shortcut function for sending job success update message |
| [sendJobStatusMessage](send-job-status-message.md) | [jvm]<br>fun [sendJobStatusMessage](send-job-status-message.md)(jobId: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html), state: JobState, message: [String](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html))<br>This sends a JobsControlUpdateRequest to ucloud. |
| [suspendJobs](suspend-jobs.md) | [jvm]<br>fun [suspendJobs](suspend-jobs.md)(jobs: [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Job&gt;) |
| [suspendStack](suspend-stack.md) | [jvm]<br>fun [suspendStack](suspend-stack.md)(stack: Stack) |
| [updateStackLastCharged](update-stack-last-charged.md) | [jvm]<br>fun [updateStackLastCharged](update-stack-last-charged.md)(listStack: Stack, chargedAt: [Instant](https://docs.oracle.com/javase/8/docs/api/java/time/Instant.html)): [Boolean](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-boolean/index.html)<br>Update the lastCharged timestamp on a stack |
| [verifyJob](verify-job.md) | [jvm]<br>fun [verifyJob](verify-job.md)(job: Job)<br>Verify a jobs status matches the status of the corresponding stack in openstack If no stack found in openstack, assume deleted and send status update to ucloud |
| [verifyJobs](verify-jobs.md) | [jvm]<br>fun [verifyJobs](verify-jobs.md)(jobs: [List](https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html)&lt;Job&gt;) |
