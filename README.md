# OpenStackGateway

Compute provider API for UCloud

## Overview
This service facilitates communication between Ucloud and Claaudia OpenStack.
It is a stateless service with an API built after UCloud provider specification.


## Technology
The service is built with Kotlin and Spring Boot. 
It uses the gradle build tool 


## Swagger
The swagger ui can be reached at the base url.
Authentication is enabled, and a Bearer token can be added using the "Authorize" button.
The API can also be tested directly with cURL.
The autogenerated requests for many of the endpoints cannot be shown. 
I have included examples of requests [here](src/test/resources/requests/create-job.json) to test the provider API.

For the manual insertion endpoint there is an example [here](src/test/resources/requests/temp-job-request-example.json).

## Security

### Inbound.
Ucloud sends a jwt token with all their requests made with a predetermined key-pair.
SecurityConfig configures swagger endpoints to be publicly and requires authentication on all other endpoints.
A custom AuthorizationFilter is added to the Spring Security Filter Chain.
This decodes the Bearer token from the header and validates it and makes sure the payload is correct.
Authentication is disabled when SPRING_PROFILES_ACTIVE is set to "local"

Otherwise, this can be tested by generating a RS256 public/private key-pair and use them to create a token with the required payload ([jwt.io](https://jwt.io/)).
The public key needs to be added to the config.

### Outbound
Not yet implemented. Will use a token of the same type as received from ucloud.
There will be an endpoint at ucloud for exchange a refresh token for an access token.
See more here: [UCloud Compute Providers](https://github.com/SDU-eScience/UCloud/blob/scheduling/backend/app-orchestrator-service/wiki/provider.md)

### PRELIMINARY UCloud Provider API Spec:
This is outdated and subject to change!

[Provider API](specs/ProviderAPI.html)

# Model generation.

`./gradlew openApiGenerate`

can be used to generate models
Not everything works however. I needed to use the bulkrequest model from ucloud as well as some modifications to them.
This will need to be updated in the future.
It uses the spec definition from the specs folder.

# Deployments

To be written