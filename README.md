# OpenStackGateway

Compute provider API for UCloud

## Overview
This service facilitates communication between Ucloud and Claaudia OpenStack.
It is a stateless service with an API built after UCloud provider specification.

## Documentation
More detailed developer documentation can be found [here](documentation)

This documentation is generated with [Dokka](https://github.com/Kotlin/dokka) in github flavored markdown:

`./gradlew dokkaGfm`

## Technology
The service is built with Kotlin and Spring Boot. 
It uses the gradle build tool 


## Swagger
The swagger ui can be reached at the base url.
Authentication is enabled, and a Bearer token can be added using the "Authorize" button.
The API can also be tested directly with cURL.
The autogenerated requests for many of the endpoints cannot be shown. 
I have included examples of requests [here](src/test/resources/requests/create-job.json) 
to test the provider API.

For the manual insertion endpoint there is an example [here](src/test/resources/requests/temp-job-request-example.json).

## Security

This is handled by UClouds provider integration module: [Jvm-Provider-Support](https://github.com/SDU-eScience/UCloud/tree/master/backend/jvm-provider-support)
A certificate and a refresh_token is added to the config and used to authenticate 
the provider integration module on inbound and outbound requests.
See more here: [UCloud Compute Providers](https://github.com/SDU-eScience/UCloud/tree/master/provider-integration/integration-module)

### PRELIMINARY UCloud Provider API Spec:
This is outdated and subject to change!

[Provider API](specs/ProviderAPI.html)

# DEPRECATED Model generation.

`./gradlew openApiGenerate`

can be used to generate models
Not everything works however. I needed to use the bulkrequest model from ucloud as well as some modifications to them.
This will need to be updated in the future.
It uses the spec definition from the specs folder.

# Deployments

To be written

# Openstack compute flavors
The general compute flavors are based on deic's type1 descriptions available [somewhere](somewhere).

GPU instances are based on our current hardware,
machines with six t4 GPUs, 256GB memory,
and 64 vCPUs (2x16 core EPYCs).

Storage is based on whatever we did on our old OpenStack platform.

Pricing is just an example

Name | vCPU | RAM | Volatile Storage | GPU | Price
--- | --- | --- | --- | --- | --- 
uc-general-small | 4 vCPU | 16 Gb | 1 Tb | N/A | 0.34 DKK/hour
uc-general-medium | 8 vCPU | 32 Gb | 1 Tb | N/A | 0.68 DKK/hour
uc-general-large | 16 vCPU | 64 Gb | 1 Tb | N/A | 1.37 DKK/hour
uc-general-xlarge | 64 vCPU | 256 Gb | 1 Tb | N/A | 5.50 DKK/hour
uc-t4-1 | 10 vCPU | 40 Gb | 1 Tb | T4 16 Gb | 8.50 DKK/hour
